<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Organization Hub - WasteNaut</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../resources/styles/main.css" />
  </head>
  <body>
    <!-- Header Container -->
    <div id="header-container"></div>

    <!-- Main Content -->
    <div class="container py-4">
      <!-- Header -->
      <div id="dashboard" class="row mb-4">
        <div class="col-12">
          <div class="d-flex align-items-center mb-3">
            <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
              <i class="bi bi-building text-white fs-5"></i>
            </div>
            <div>
              <h1 class="h3 mb-1 text-gradient">Organization Hub</h1>
              <p class="text-muted mb-0">Food bank management and resource coordination</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Organization Profile Card -->
      <div class="row g-4 mb-4">
        <div class="col-lg-4">
          <div class="card border-0 bg-dark glow-effect">
            <div class="card-header bg-dark border-bottom">
              <h5 class="mb-0">
                <i class="bi bi-building me-2"></i>Organization Profile
              </h5>
            </div>
            <div class="card-body">
              <div class="text-center mb-3">
                <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 60px; height: 60px;">
                  <i class="bi bi-building text-white fs-3"></i>
                </div>
                <h5 class="text-gradient">Green Valley Food Bank</h5>
                <p class="text-muted small">Serving the community since 2020</p>
              </div>
              <div class="row g-2">
                <div class="col-6">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-geo-alt text-primary me-2"></i>
                    <span class="small">Downtown District</span>
                  </div>
                </div>
                <div class="col-6">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-people text-success me-2"></i>
                    <span class="small">1,250 families</span>
                  </div>
                </div>
                <div class="col-6">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-clock text-warning me-2"></i>
                    <span class="small">Mon-Fri 9AM-5PM</span>
                  </div>
                </div>
                <div class="col-6">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-shield-check text-info me-2"></i>
                    <span class="small">Verified</span>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <button class="btn btn-primary btn-sm w-100" onclick="editProfile()">
                  <i class="bi bi-pencil me-1"></i>Edit Profile
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Inventory Summary -->
        <div id="inventory" class="col-lg-8">
          <div class="card border-0 bg-dark">
            <div class="card-header bg-dark border-bottom">
              <h5 class="mb-0">
                <i class="bi bi-boxes me-2"></i>Inventory Summary
              </h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-3">
                  <div class="text-center">
                    <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                      <i class="bi bi-apple text-white fs-4"></i>
                    </div>
                    <div class="fw-bold fs-4">245</div>
                    <div class="small text-muted">Fresh Produce</div>
                    <div class="small text-success">Good Stock</div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="text-center">
                    <div class="bg-warning rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                      <i class="bi bi-box text-white fs-4"></i>
                    </div>
                    <div class="fw-bold fs-4">89</div>
                    <div class="small text-muted">Canned Goods</div>
                    <div class="small text-warning">Low Stock</div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="text-center">
                    <div class="bg-info rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                      <i class="bi bi-droplet text-white fs-4"></i>
                    </div>
                    <div class="fw-bold fs-4">156</div>
                    <div class="small text-muted">Dairy Items</div>
                    <div class="small text-info">Medium Stock</div>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="text-center">
                    <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                      <i class="bi bi-bread-slice text-white fs-4"></i>
                    </div>
                    <div class="fw-bold fs-4">67</div>
                    <div class="small text-muted">Bakery Items</div>
                    <div class="small text-danger">Critical</div>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                  <i class="bi bi-exclamation-triangle me-2"></i>
                  <strong>Low Stock Alert:</strong> Bakery items and canned goods need restocking.
                  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Volunteers/Contacts and Pending Requests -->
      <div class="row g-4 mb-4">
        <!-- Volunteers/Contacts List -->
        <div class="col-lg-6">
          <div class="card border-0 bg-dark h-100">
            <div class="card-header bg-dark border-bottom">
              <h5 class="mb-0">
                <i class="bi bi-people me-2"></i>Volunteers & Contacts
              </h5>
            </div>
            <div class="card-body">
              <div class="list-group list-group-flush">
                <div class="list-group-item bg-dark border-secondary">
                  <div class="d-flex align-items-center">
                    <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                      <i class="bi bi-person text-white"></i>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="mb-1">Sarah Johnson</h6>
                      <p class="mb-1 small text-muted">Volunteer Coordinator</p>
                      <small class="text-success">Available Today</small>
                    </div>
                    <div class="btn-group" role="group">
                      <button class="btn btn-sm btn-outline-primary" onclick="contactVolunteer('sarah_johnson')">
                        <i class="bi bi-chat"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-info" onclick="editVolunteer('sarah_johnson')">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" onclick="deleteVolunteer('sarah_johnson')">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="list-group-item bg-dark border-secondary">
                  <div class="d-flex align-items-center">
                    <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                      <i class="bi bi-person text-white"></i>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="mb-1">Mike Chen</h6>
                      <p class="mb-1 small text-muted">Delivery Driver</p>
                      <small class="text-info">On Route</small>
                    </div>
                    <div class="btn-group" role="group">
                      <button class="btn btn-sm btn-outline-success" onclick="contactVolunteer('mike_chen')">
                        <i class="bi bi-telephone"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-info" onclick="editVolunteer('mike_chen')">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" onclick="deleteVolunteer('mike_chen')">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="list-group-item bg-dark border-secondary">
                  <div class="d-flex align-items-center">
                    <div class="bg-warning rounded-circle d-inline-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                      <i class="bi bi-person text-white"></i>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="mb-1">Lisa Rodriguez</h6>
                      <p class="mb-1 small text-muted">Inventory Manager</p>
                      <small class="text-warning">Break until 2PM</small>
                    </div>
                    <div class="btn-group" role="group">
                      <button class="btn btn-sm btn-outline-warning" onclick="contactVolunteer('lisa_rodriguez')">
                        <i class="bi bi-envelope"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-primary" onclick="editVolunteer('lisa_rodriguez')">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" onclick="deleteVolunteer('lisa_rodriguez')">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <button class="btn btn-primary btn-sm w-100" onclick="addVolunteer()">
                  <i class="bi bi-person-plus me-1"></i>Add Volunteer
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Pending Requests Queue -->
        <div id="requests" class="col-lg-6">
          <div class="card border-0 bg-dark h-100">
            <div class="card-header bg-dark border-bottom">
              <h5 class="mb-0">
                <i class="bi bi-clock me-2"></i>Pending Requests
              </h5>
            </div>
            <div class="card-body">
              <div class="list-group list-group-flush">
                <div class="list-group-item bg-dark border-secondary">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h6 class="mb-1">Family of 4 - Fresh Vegetables</h6>
                      <p class="mb-1 small text-muted">Requested: 2 hours ago</p>
                      <span class="badge bg-success">High Priority</span>
                    </div>
                    <div class="btn-group" role="group">
                      <button class="btn btn-sm btn-success" onclick="fulfillRequest(1)">
                        <i class="bi bi-check-circle"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-primary" onclick="editRequest(1)">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" onclick="deleteRequest(1)">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="list-group-item bg-dark border-secondary">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h6 class="mb-1">Senior Center - Canned Goods</h6>
                      <p class="mb-1 small text-muted">Requested: 4 hours ago</p>
                      <span class="badge bg-warning">Medium Priority</span>
                    </div>
                    <div class="btn-group" role="group">
                      <button class="btn btn-sm btn-warning" onclick="fulfillRequest(2)">
                        <i class="bi bi-clock"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-primary" onclick="editRequest(2)">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" onclick="deleteRequest(2)">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="list-group-item bg-dark border-secondary">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h6 class="mb-1">Community Kitchen - Bulk Items</h6>
                      <p class="mb-1 small text-muted">Requested: 6 hours ago</p>
                      <span class="badge bg-info">Low Priority</span>
                    </div>
                    <div class="btn-group" role="group">
                      <button class="btn btn-sm btn-info" onclick="fulfillRequest(3)">
                        <i class="bi bi-arrow-right"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-primary" onclick="editRequest(3)">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" onclick="deleteRequest(3)">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <button class="btn btn-outline-primary btn-sm w-100" onclick="viewAllRequests()">
                  <i class="bi bi-list-ul me-1"></i>View All Requests
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons and KPI Charts -->
      <div class="row g-4 mb-4">
        <!-- Action Buttons -->

        <!-- KPI Charts Placeholder -->
        <div class="col-lg-8">
          <div class="card border-0 bg-dark">
            <div class="card-header bg-dark border-bottom">
              <h5 class="mb-0">
                <i class="bi bi-graph-up me-2"></i>Key Performance Indicators
              </h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="card border-0 bg-dark glow-effect">
                    <div class="card-body text-center p-3">
                      <div class="bg-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                        <i class="bi bi-people text-white fs-4"></i>
                      </div>
                      <div class="fw-bold fs-3">1,250</div>
                      <div class="small text-muted">Families Served</div>
                      <div class="small text-success">+15% this month</div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card border-0 bg-dark glow-effect">
                    <div class="card-body text-center p-3">
                      <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                        <i class="bi bi-recycle text-white fs-4"></i>
                      </div>
                      <div class="fw-bold fs-3">2,847</div>
                      <div class="small text-muted">Lbs Food Rescued</div>
                      <div class="small text-success">+22% this month</div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card border-0 bg-dark glow-effect">
                    <div class="card-body text-center p-3">
                      <div class="bg-warning rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                        <i class="bi bi-clock text-white fs-4"></i>
                      </div>
                      <div class="fw-bold fs-3">94%</div>
                      <div class="small text-muted">On-Time Delivery</div>
                      <div class="small text-success">+3% this month</div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card border-0 bg-dark glow-effect">
                    <div class="card-body text-center p-3">
                      <div class="bg-info rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                        <i class="bi bi-star text-white fs-4"></i>
                      </div>
                      <div class="fw-bold fs-3">4.8</div>
                      <div class="small text-muted">Satisfaction Rating</div>
                      <div class="small text-success">+0.2 this month</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark border-top py-4">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <p class="mb-0 text-muted">&copy; 2024 WasteNaut. Navigating the future of sustainable resource management.</p>
          </div>
          <div class="col-md-6 text-md-end">
            <div class="footer-btn-container">
              <button class="footer-btn text-muted me-3" data-info="contact@wastenaut.com" title="Email us">
                <i class="bi bi-envelope"></i>
              </button>
              <button class="footer-btn text-muted me-3" data-info="+1-555-WASTE-NAUT" title="Call us">
                <i class="bi bi-telephone"></i>
              </button>
              <button class="footer-btn text-muted" data-info="WasteNaut - Fighting food waste through space-age technology" title="About us">
                <i class="bi bi-info-circle"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap JS bundle -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- Custom JS -->
    <script src="../resources/scripts/main.js"></script>
    <script src="../resources/scripts/api-service.js"></script>
    <script src="../resources/scripts/auth.js"></script>
    <script src="../resources/scripts/header-include.js"></script>
    <script src="../resources/scripts/header.js"></script>
    <script>
      // Organization dashboard functionality
      function fulfillRequest(requestId) {
        if (window.showNotification) {
          window.showNotification(`Request ${requestId} fulfilled successfully!`, 'success');
        } else {
          showAlert(`Request ${requestId} fulfilled successfully!`, 'success');
        }
      }

      function openInventoryManagement() {
        window.location.href = 'inventory-management.html';
      }

      function openSmartMatching() {
        window.location.href = 'smart-matching.html';
      }

      function openCommunicationHub() {
        window.location.href = 'communication-hub.html';
      }

      function generateReport() {
        if (window.showNotification) {
          window.showNotification('Generating monthly report...', 'info');
        } else {
          showAlert('Generating monthly report...', 'info');
        }
      }

      function requestDonation() {
        if (window.showNotification) {
          window.showNotification('Opening donation request form...', 'info');
        } else {
          showAlert('Opening donation request form...', 'info');
        }
      }

      function contactVolunteer(volunteerId) {
        window.apiService.getVolunteer(volunteerId)
          .then(volunteer => {
            showPageNotification(`Opening contact form for ${volunteer.name} (${volunteer.email})`, 'info');
            // In a real app, this would open an email client or messaging interface
          })
          .catch(error => {
            console.error('Failed to get volunteer:', error);
            showPageNotification(`Contacting volunteer ${volunteerId}...`, 'info');
          });
      }

      function editVolunteer(volunteerId) {
        window.apiService.getVolunteer(volunteerId)
          .then(volunteer => {
            showEditVolunteerModal(volunteer);
          })
          .catch(error => {
            console.error('Failed to get volunteer:', error);
            showPageNotification('Volunteer not found.', 'error');
          });
      }
      
      function showEditVolunteerModal(volunteer) {
        const modalHTML = `
          <div class="modal fade" id="editVolunteerModal" tabindex="-1" aria-labelledby="editVolunteerModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content bg-dark text-white">
                <div class="modal-header border-secondary">
                  <h5 class="modal-title" id="editVolunteerModalLabel">
                    <i class="bi bi-pencil me-2"></i>Edit Volunteer
                  </h5>
                  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <form id="editVolunteerForm">
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="editVolunteerName" class="form-label">Full Name</label>
                        <input type="text" class="form-control bg-dark text-white border-secondary" id="editVolunteerName" value="${volunteer.name}" required>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="editVolunteerEmail" class="form-label">Email Address</label>
                        <input type="email" class="form-control bg-dark text-white border-secondary" id="editVolunteerEmail" value="${volunteer.email}" required>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="editVolunteerPhone" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control bg-dark text-white border-secondary" id="editVolunteerPhone" value="${volunteer.phone}" required>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="editVolunteerRole" class="form-label">Role</label>
                        <select class="form-select bg-dark text-white border-secondary" id="editVolunteerRole" required>
                          <option value="coordinator" ${volunteer.role === 'coordinator' ? 'selected' : ''}>Volunteer Coordinator</option>
                          <option value="driver" ${volunteer.role === 'driver' ? 'selected' : ''}>Delivery Driver</option>
                          <option value="sorter" ${volunteer.role === 'sorter' ? 'selected' : ''}>Food Sorter</option>
                          <option value="distributor" ${volunteer.role === 'distributor' ? 'selected' : ''}>Distribution Helper</option>
                          <option value="admin" ${volunteer.role === 'admin' ? 'selected' : ''}>Administrator</option>
                          <option value="general" ${volunteer.role === 'general' ? 'selected' : ''}>General Volunteer</option>
                        </select>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="editVolunteerSkills" class="form-label">Skills & Availability</label>
                      <textarea class="form-control bg-dark text-white border-secondary" id="editVolunteerSkills" rows="3">${volunteer.skills || ''}</textarea>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="editVolunteerStartDate" class="form-label">Start Date</label>
                        <input type="date" class="form-control bg-dark text-white border-secondary" id="editVolunteerStartDate" value="${volunteer.startDate}" required>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="editVolunteerStatus" class="form-label">Status</label>
                        <select class="form-select bg-dark text-white border-secondary" id="editVolunteerStatus" required>
                          <option value="active" ${volunteer.status === 'active' ? 'selected' : ''}>Active</option>
                          <option value="pending" ${volunteer.status === 'pending' ? 'selected' : ''}>Pending</option>
                          <option value="inactive" ${volunteer.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                        </select>
                      </div>
                    </div>
                  </form>
                </div>
                <div class="modal-footer border-secondary">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-primary" onclick="updateVolunteer('${volunteer.id}')">
                    <i class="bi bi-check me-1"></i>Save Changes
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
        
        // Remove existing modal if it exists
        const existingModal = document.getElementById('editVolunteerModal');
        if (existingModal) {
          existingModal.remove();
        }
        
        // Add modal to page
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('editVolunteerModal'));
        modal.show();
      }
      
      function updateVolunteer(volunteerId) {
        const updateData = {
          name: document.getElementById('editVolunteerName').value,
          email: document.getElementById('editVolunteerEmail').value,
          phone: document.getElementById('editVolunteerPhone').value,
          role: document.getElementById('editVolunteerRole').value,
          skills: document.getElementById('editVolunteerSkills').value,
          startDate: document.getElementById('editVolunteerStartDate').value,
          status: document.getElementById('editVolunteerStatus').value
        };
        
        // Call API to update volunteer
        window.apiService.updateVolunteer(volunteerId, updateData)
          .then(() => {
            // Hide modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('editVolunteerModal'));
            modal.hide();
            
            // Show success message
            showPageNotification(`Volunteer ${updateData.name} updated successfully!`, 'success');
            
            // Refresh volunteers list
            loadVolunteers();
            
            // Clean up modal
            setTimeout(() => {
              const modalElement = document.getElementById('editVolunteerModal');
              if (modalElement) {
                modalElement.remove();
              }
            }, 300);
          })
          .catch(error => {
            console.error('Failed to update volunteer:', error);
            showPageNotification('Failed to update volunteer. Please try again.', 'error');
          });
      }

      function deleteVolunteer(volunteerId) {
        window.apiService.getVolunteer(volunteerId)
          .then(volunteer => {
            if (confirm(`Are you sure you want to remove volunteer ${volunteer.name}?`)) {
              // Call API to delete volunteer
              return window.apiService.deleteVolunteer(volunteerId);
            }
            return Promise.reject('Cancelled by user');
          })
          .then(() => {
            // Show success message
            showPageNotification(`Volunteer removed successfully`, 'success');
            
            // Refresh volunteers list
            loadVolunteers();
          })
          .catch(error => {
            if (error !== 'Cancelled by user') {
              console.error('Failed to delete volunteer:', error);
              showPageNotification('Failed to remove volunteer. Please try again.', 'error');
            }
          });
      }

      // Request management functions
      function editRequest(requestId) {
        const newPriority = prompt('Enter new priority (High/Medium/Low):');
        if (newPriority && ['High', 'Medium', 'Low'].includes(newPriority)) {
          const updateData = {
            priority: newPriority
          };
          
          window.apiService.updateRequest(requestId, updateData)
            .then(() => {
              showPageNotification(`Updated request #${requestId} priority to: ${newPriority}`, 'success');
              loadAllRequests();
            })
            .catch(error => {
              console.error('Failed to update request:', error);
              showPageNotification('Failed to update request. Please try again.', 'error');
            });
        }
      }

      function deleteRequest(requestId) {
        if (confirm(`Are you sure you want to delete request #${requestId}?`)) {
          window.apiService.deleteRequest(requestId)
            .then(() => {
              showPageNotification(`Request #${requestId} deleted successfully`, 'success');
              loadAllRequests();
            })
            .catch(error => {
              console.error('Failed to delete request:', error);
              showPageNotification('Failed to delete request. Please try again.', 'error');
            });
        }
      }

      // New comprehensive functions
      function editProfile() {
        showEditProfileModal();
      }
      
      function showEditProfileModal() {
        const user = JSON.parse(localStorage.getItem('wastenaut_user') || '{}');
        
        const modalHTML = `
          <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
              <div class="modal-content bg-dark text-white">
                <div class="modal-header border-secondary">
                  <h5 class="modal-title" id="editProfileModalLabel">
                    <i class="bi bi-pencil me-2"></i>Edit Organization Profile
                  </h5>
                  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <form id="editProfileForm">
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="editOrgName" class="form-label">Organization Name</label>
                        <input type="text" class="form-control bg-dark text-white border-secondary" id="editOrgName" value="${user.organizationName || 'Community Food Bank'}" required>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="editOrgType" class="form-label">Organization Type</label>
                        <select class="form-select bg-dark text-white border-secondary" id="editOrgType" required>
                          <option value="foodbank" ${user.orgType === 'foodbank' ? 'selected' : ''}>Food Bank</option>
                          <option value="shelter" ${user.orgType === 'shelter' ? 'selected' : ''}>Homeless Shelter</option>
                          <option value="community" ${user.orgType === 'community' ? 'selected' : ''}>Community Center</option>
                          <option value="church" ${user.orgType === 'church' ? 'selected' : ''}>Religious Organization</option>
                          <option value="nonprofit" ${user.orgType === 'nonprofit' ? 'selected' : ''}>Non-Profit</option>
                        </select>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="editContactName" class="form-label">Contact Person</label>
                        <input type="text" class="form-control bg-dark text-white border-secondary" id="editContactName" value="${user.name || 'John Smith'}" required>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="editContactEmail" class="form-label">Contact Email</label>
                        <input type="email" class="form-control bg-dark text-white border-secondary" id="editContactEmail" value="${user.email || 'contact@foodbank.org'}" required>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="editContactPhone" class="form-label">Contact Phone</label>
                        <input type="tel" class="form-control bg-dark text-white border-secondary" id="editContactPhone" value="${user.phone || '(555) 123-4567'}" required>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="editWebsite" class="form-label">Website</label>
                        <input type="url" class="form-control bg-dark text-white border-secondary" id="editWebsite" value="${user.website || 'https://foodbank.org'}">
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="editAddress" class="form-label">Address</label>
                      <textarea class="form-control bg-dark text-white border-secondary" id="editAddress" rows="2" required>${user.address || '123 Main Street, City, State 12345'}</textarea>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="editCapacity" class="form-label">Daily Capacity</label>
                        <input type="number" class="form-control bg-dark text-white border-secondary" id="editCapacity" value="${user.capacity || 500}" min="1">
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="editOperatingHours" class="form-label">Operating Hours</label>
                        <input type="text" class="form-control bg-dark text-white border-secondary" id="editOperatingHours" value="${user.operatingHours || 'Mon-Fri 9AM-5PM'}" placeholder="e.g., Mon-Fri 9AM-5PM">
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="editDescription" class="form-label">Organization Description</label>
                      <textarea class="form-control bg-dark text-white border-secondary" id="editDescription" rows="3">${user.description || 'We are a community food bank dedicated to fighting hunger and reducing food waste in our area.'}</textarea>
                    </div>
                  </form>
                </div>
                <div class="modal-footer border-secondary">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-primary" onclick="updateProfile()">
                    <i class="bi bi-check me-1"></i>Save Changes
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
        
        // Remove existing modal if it exists
        const existingModal = document.getElementById('editProfileModal');
        if (existingModal) {
          existingModal.remove();
        }
        
        // Add modal to page
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('editProfileModal'));
        modal.show();
      }
      
      function updateProfile() {
        const user = JSON.parse(localStorage.getItem('wastenaut_user') || '{}');
        
        // Update user data
        const updatedUser = {
          ...user,
          organizationName: document.getElementById('editOrgName').value,
          orgType: document.getElementById('editOrgType').value,
          name: document.getElementById('editContactName').value,
          email: document.getElementById('editContactEmail').value,
          phone: document.getElementById('editContactPhone').value,
          website: document.getElementById('editWebsite').value,
          address: document.getElementById('editAddress').value,
          capacity: parseInt(document.getElementById('editCapacity').value),
          operatingHours: document.getElementById('editOperatingHours').value,
          description: document.getElementById('editDescription').value,
          lastUpdated: new Date().toISOString()
        };
        
        // Save to localStorage for immediate UI update
        localStorage.setItem('wastenaut_user', JSON.stringify(updatedUser));
        
        // Update backend database
        const organizationId = user.organizationId || 1; // Default to organization ID 1
        const updateData = {
          name: updatedUser.organizationName,
          type: updatedUser.orgType,
          contactName: updatedUser.name,
          contactEmail: updatedUser.email,
          contactPhone: updatedUser.phone,
          website: updatedUser.website,
          address: updatedUser.address,
          capacityMax: updatedUser.capacity,
          operatingHours: updatedUser.operatingHours,
          description: updatedUser.description
        };
        
        // Call API to update backend
        window.apiService.updateOrganizationProfile(organizationId, updateData)
          .then(() => {
            // Hide modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('editProfileModal'));
            modal.hide();
            
            // Show success message
            showPageNotification('Profile updated successfully!', 'success');
            
            // Refresh page data
            loadOrganizationData();
            
            // Clean up modal
            setTimeout(() => {
              const modalElement = document.getElementById('editProfileModal');
              if (modalElement) {
                modalElement.remove();
              }
            }, 300);
          })
          .catch(error => {
            console.error('Failed to update profile:', error);
            showPageNotification('Failed to update profile. Please try again.', 'error');
          });
      }
      
      function addVolunteer() {
        showAddVolunteerModal();
      }
      
      function showAddVolunteerModal() {
        const modalHTML = `
          <div class="modal fade" id="addVolunteerModal" tabindex="-1" aria-labelledby="addVolunteerModalLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content bg-dark text-white">
                <div class="modal-header border-secondary">
                  <h5 class="modal-title" id="addVolunteerModalLabel">
                    <i class="bi bi-person-plus me-2"></i>Add New Volunteer
                  </h5>
                  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <form id="addVolunteerForm">
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="addVolunteerName" class="form-label">Full Name</label>
                        <input type="text" class="form-control bg-dark text-white border-secondary" id="addVolunteerName" required>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="addVolunteerEmail" class="form-label">Email Address</label>
                        <input type="email" class="form-control bg-dark text-white border-secondary" id="addVolunteerEmail" required>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="addVolunteerPhone" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control bg-dark text-white border-secondary" id="addVolunteerPhone" required>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="addVolunteerRole" class="form-label">Role</label>
                        <select class="form-select bg-dark text-white border-secondary" id="addVolunteerRole" required>
                          <option value="">Select a role</option>
                          <option value="coordinator">Volunteer Coordinator</option>
                          <option value="driver">Delivery Driver</option>
                          <option value="sorter">Food Sorter</option>
                          <option value="distributor">Distribution Helper</option>
                          <option value="admin">Administrator</option>
                          <option value="general">General Volunteer</option>
                        </select>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label for="addVolunteerSkills" class="form-label">Skills & Availability</label>
                      <textarea class="form-control bg-dark text-white border-secondary" id="addVolunteerSkills" rows="3" placeholder="e.g., Available weekends, has truck license, food safety certified"></textarea>
                    </div>
                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="addVolunteerStartDate" class="form-label">Start Date</label>
                        <input type="date" class="form-control bg-dark text-white border-secondary" id="addVolunteerStartDate" required>
                      </div>
                      <div class="col-md-6 mb-3">
                        <label for="addVolunteerStatus" class="form-label">Status</label>
                        <select class="form-select bg-dark text-white border-secondary" id="addVolunteerStatus" required>
                          <option value="pending">Pending</option>
                          <option value="active">Active</option>
                          <option value="inactive">Inactive</option>
                        </select>
                      </div>
                    </div>
                  </form>
                </div>
                <div class="modal-footer border-secondary">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-primary" onclick="saveNewVolunteer()">
                    <i class="bi bi-plus me-1"></i>Add Volunteer
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
        
        // Remove existing modal if it exists
        const existingModal = document.getElementById('addVolunteerModal');
        if (existingModal) {
          existingModal.remove();
        }
        
        // Add modal to page
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // Set default start date to today
        document.getElementById('addVolunteerStartDate').value = new Date().toISOString().split('T')[0];
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('addVolunteerModal'));
        modal.show();
      }
      
      function saveNewVolunteer() {
        const user = JSON.parse(localStorage.getItem('wastenaut_user') || '{}');
        const organizationId = user.organizationId || 1; // Default to organization ID 1
        
        // Create new volunteer data
        const newVolunteerData = {
          name: document.getElementById('addVolunteerName').value,
          email: document.getElementById('addVolunteerEmail').value,
          phone: document.getElementById('addVolunteerPhone').value,
          role: document.getElementById('addVolunteerRole').value,
          skills: document.getElementById('addVolunteerSkills').value,
          startDate: document.getElementById('addVolunteerStartDate').value,
          status: document.getElementById('addVolunteerStatus').value,
          organizationId: organizationId
        };
        
        // Call API to create volunteer
        window.apiService.createVolunteer(newVolunteerData)
          .then(volunteer => {
            // Hide modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addVolunteerModal'));
            modal.hide();
            
            // Show success message
            showPageNotification(`Volunteer ${volunteer.name} added successfully!`, 'success');
            
            // Refresh volunteers list
            loadVolunteers();
            
            // Clean up modal
            setTimeout(() => {
              const modalElement = document.getElementById('addVolunteerModal');
              if (modalElement) {
                modalElement.remove();
              }
            }, 300);
          })
          .catch(error => {
            console.error('Failed to create volunteer:', error);
            showPageNotification('Failed to add volunteer. Please try again.', 'error');
          });
      }
      
      function viewAllRequests() {
        showAllRequestsModal();
      }
      
      function showAllRequestsModal() {
        const modalHTML = `
          <div class="modal fade" id="allRequestsModal" tabindex="-1" aria-labelledby="allRequestsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
              <div class="modal-content bg-dark text-white">
                <div class="modal-header border-secondary">
                  <h5 class="modal-title" id="allRequestsModalLabel">
                    <i class="bi bi-list-ul me-2"></i>All Requests
                  </h5>
                  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <div class="table-responsive">
                    <table class="table table-dark table-hover">
                      <thead>
                        <tr>
                          <th>ID</th>
                          <th>Requester</th>
                          <th>Items</th>
                          <th>Priority</th>
                          <th>Status</th>
                          <th>Date</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody id="requestsTableBody">
                        <!-- Requests will be loaded here -->
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="modal-footer border-secondary">
                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                  <button type="button" class="btn btn-primary" onclick="addNewRequest()">
                    <i class="bi bi-plus me-1"></i>Add Request
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
        
        // Remove existing modal if it exists
        const existingModal = document.getElementById('allRequestsModal');
        if (existingModal) {
          existingModal.remove();
        }
        
        // Add modal to page
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('allRequestsModal'));
        modal.show();
        
        // Load requests
        loadAllRequests();
      }
      
      function loadAllRequests() {
        const user = JSON.parse(localStorage.getItem('wastenaut_user') || '{}');
        const organizationId = user.organizationId || 1; // Default to organization ID 1
        
        window.apiService.getRequests(organizationId)
          .then(requests => {
            const tableBody = document.getElementById('requestsTableBody');
            if (!tableBody) return;
            
            // Clear existing rows
            tableBody.innerHTML = '';
            
            // Add request rows
            requests.forEach(request => {
              const row = document.createElement('tr');
              const priorityClass = request.priority === 'High' ? 'text-danger' : 
                                  request.priority === 'Medium' ? 'text-warning' : 'text-success';
              const statusClass = request.status === 'Completed' ? 'text-success' : 
                                request.status === 'In Progress' ? 'text-warning' : 'text-info';
              
              row.innerHTML = `
                <td>#${request.id}</td>
                <td>${request.requester}</td>
                <td>${request.items}</td>
                <td><span class="${priorityClass}">${request.priority}</span></td>
                <td><span class="${statusClass}">${request.status}</span></td>
                <td>${new Date(request.requestDate).toLocaleDateString()}</td>
                <td>
                  <button class="btn btn-sm btn-outline-primary me-1" onclick="editRequest(${request.id})">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" onclick="deleteRequest(${request.id})">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              `;
              
              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Failed to load requests:', error);
            showPageNotification('Failed to load requests. Please refresh the page.', 'error');
          });
      }
      
      function addNewRequest() {
        const requester = prompt('Enter requester name:');
        if (!requester) return;
        
        const items = prompt('Enter requested items:');
        if (!items) return;
        
        const priority = prompt('Enter priority (High/Medium/Low):');
        if (!priority || !['High', 'Medium', 'Low'].includes(priority)) return;
        
        const user = JSON.parse(localStorage.getItem('wastenaut_user') || '{}');
        const organizationId = user.organizationId || 1; // Default to organization ID 1
        
        const newRequestData = {
          requester: requester,
          items: items,
          priority: priority,
          status: 'Pending',
          organizationId: organizationId
        };
        
        window.apiService.createRequest(newRequestData)
          .then(request => {
            showPageNotification(`Request #${request.id} added successfully!`, 'success');
            loadAllRequests();
          })
          .catch(error => {
            console.error('Failed to create request:', error);
            showPageNotification('Failed to add request. Please try again.', 'error');
          });
      }
      
      function loadVolunteers() {
        const user = JSON.parse(localStorage.getItem('wastenaut_user') || '{}');
        const organizationId = user.organizationId || 1; // Default to organization ID 1
        
        window.apiService.getVolunteers(organizationId)
          .then(volunteers => {
            // Update the volunteers list in the UI
            const volunteersContainer = document.querySelector('.list-group-flush');
            if (volunteersContainer) {
              // Clear existing volunteer items (keep the header)
              const existingItems = volunteersContainer.querySelectorAll('.list-group-item:not(.list-group-item-dark)');
              existingItems.forEach(item => item.remove());
              
              // Add volunteers from API
              volunteers.forEach(volunteer => {
                const volunteerElement = createVolunteerElement(volunteer);
                volunteersContainer.appendChild(volunteerElement);
              });
            }
            
            showPageNotification('Volunteers list refreshed', 'info');
          })
          .catch(error => {
            console.error('Failed to load volunteers:', error);
            showPageNotification('Failed to load volunteers. Please refresh the page.', 'error');
          });
      }
      
      function createVolunteerElement(volunteer) {
        const listItem = document.createElement('li');
        listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
        
        const roleClass = volunteer.role === 'coordinator' ? 'success' : 
                         volunteer.role === 'driver' ? 'primary' : 
                         volunteer.role === 'sorter' ? 'info' : 'secondary';
        
        listItem.innerHTML = `
          <div class="d-flex align-items-center">
            <div class="me-3">
              <div class="rounded-circle bg-${roleClass} d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                <i class="bi bi-person-fill text-white"></i>
              </div>
            </div>
            <div>
              <h6 class="mb-1">${volunteer.name}</h6>
              <p class="mb-1 small text-muted">${volunteer.role.charAt(0).toUpperCase() + volunteer.role.slice(1)}</p>
            </div>
          </div>
          <div class="btn-group">
            <button class="btn btn-sm btn-outline-primary" onclick="contactVolunteer(${volunteer.id})">
              <i class="bi bi-envelope"></i>
            </button>
            <button class="btn btn-sm btn-outline-info" onclick="editVolunteer(${volunteer.id})">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteVolunteer(${volunteer.id})">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        `;
        
        return listItem;
      }
      
      function loadOrganizationData() {
        // This function would refresh the organization data in the UI
        // For now, we'll just show a notification
        showPageNotification('Organization data refreshed', 'info');
      }
      
      function showPageNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 400px;';
        notification.innerHTML = `
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        
        // Add to page
        document.body.appendChild(notification);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
          if (notification.parentNode) {
            notification.remove();
          }
        }, 5000);
      }


      // Footer button popup functionality
      function createPopup(text, button) {
        // Remove any existing popups
        const existingPopups = document.querySelectorAll('.wastenaut-popup');
        existingPopups.forEach(popup => popup.remove());
        
        // Create popup element
        const popup = document.createElement('div');
        popup.className = 'wastenaut-popup';
        popup.textContent = text;
        
        // Calculate position more reliably
        const buttonRect = button.getBoundingClientRect();
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;
        const popupWidth = Math.min(300, viewportWidth - 40);
        
        // Perfect centering above the button
        const popupHeight = 50; // More accurate height
        const spacing = 8; // Space between button and popup
        
        // Always try to position above first
        let topPosition = buttonRect.top - popupHeight - spacing;
        let arrowDirection = 'down';
        
        // If not enough space above, position below
        if (topPosition < 10) {
          topPosition = buttonRect.bottom + spacing;
          arrowDirection = 'up';
        }
        
        // Perfect horizontal centering - exact center of button
        let leftPosition = buttonRect.left + (buttonRect.width / 2);
        
        // Only adjust if popup would go off-screen
        const halfPopupWidth = popupWidth / 2;
        if (leftPosition - halfPopupWidth < 10) {
          leftPosition = halfPopupWidth + 10;
        } else if (leftPosition + halfPopupWidth > viewportWidth - 10) {
          leftPosition = viewportWidth - halfPopupWidth - 10;
        }
        
        popup.style.cssText = `
          position: fixed;
          top: ${topPosition}px;
          left: ${leftPosition}px;
          transform: translateX(-50%);
          background: rgba(10, 10, 10, 0.95);
          border: 1px solid #00ff88;
          border-radius: 8px;
          padding: 12px 16px;
          color: #00ff88;
          font-size: 14px;
          font-family: 'Exo 2', sans-serif;
          z-index: 9999;
          box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
          backdrop-filter: blur(10px);
          white-space: normal;
          max-width: 300px;
          width: ${popupWidth}px;
          opacity: 0;
          transition: opacity 0.3s ease;
          cursor: text;
          user-select: text;
          pointer-events: auto;
        `;
        
        // Add arrow pointing to button
        const arrow = document.createElement('div');
        arrow.style.cssText = `
          position: absolute;
          ${arrowDirection === 'down' ? 'top: 100%;' : 'bottom: 100%;'}
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 6px solid transparent;
          border-right: 6px solid transparent;
          ${arrowDirection === 'down' ? 'border-top: 6px solid #00ff88;' : 'border-bottom: 6px solid #00ff88;'}
        `;
        popup.appendChild(arrow);
        
        // Add to body
        document.body.appendChild(popup);
        
        // Fade in
        setTimeout(() => {
          popup.style.opacity = '1';
        }, 10);
        
        // Add hover functionality to popup
        popup.addEventListener('mouseenter', function() {
          popup.style.opacity = '1';
          if (popup.hideTimeout) {
            clearTimeout(popup.hideTimeout);
            popup.hideTimeout = null;
          }
        });
        
        popup.addEventListener('mouseleave', function() {
          popup.style.opacity = '0';
          popup.hideTimeout = setTimeout(() => {
            if (popup.parentNode) {
              popup.remove();
            }
          }, 300);
        });
      }
      
      function removePopup() {
        const existingPopups = document.querySelectorAll('.wastenaut-popup');
        existingPopups.forEach(popup => {
          popup.style.opacity = '0';
          setTimeout(() => {
            if (popup.parentNode) {
              popup.remove();
            }
          }, 300);
        });
      }

      // Initialize page protection and footer buttons when page loads
      document.addEventListener('DOMContentLoaded', function() {
        // Protect this page - only org users can access
        if (!authManager.protectPage('org')) {
          return;
        }
        const emailBtn = document.querySelector('button[data-info="contact@wastenaut.com"]');
        const phoneBtn = document.querySelector('button[data-info="+1-555-WASTE-NAUT"]');
        const infoBtn = document.querySelector('button[data-info="WasteNaut - Fighting food waste through space-age technology"]');
        
        if (emailBtn) {
          let emailTimeout;
          emailBtn.addEventListener('mouseenter', function() {
            clearTimeout(emailTimeout);
            createPopup('contact@wastenaut.com', this);
          });
          emailBtn.addEventListener('mouseleave', function() {
            emailTimeout = setTimeout(() => {
              const popup = document.querySelector('.wastenaut-popup');
              if (popup && !popup.matches(':hover')) {
                removePopup();
              }
            }, 150);
          });
        }
        
        if (phoneBtn) {
          let phoneTimeout;
          phoneBtn.addEventListener('mouseenter', function() {
            clearTimeout(phoneTimeout);
            createPopup('+1-555-WASTE-NAUT', this);
          });
          phoneBtn.addEventListener('mouseleave', function() {
            phoneTimeout = setTimeout(() => {
              const popup = document.querySelector('.wastenaut-popup');
              if (popup && !popup.matches(':hover')) {
                removePopup();
              }
            }, 150);
          });
        }
        
        if (infoBtn) {
          let infoTimeout;
          infoBtn.addEventListener('mouseenter', function() {
            clearTimeout(infoTimeout);
            createPopup('WasteNaut - Fighting food waste through space-age technology', this);
          });
          infoBtn.addEventListener('mouseleave', function() {
            infoTimeout = setTimeout(() => {
              const popup = document.querySelector('.wastenaut-popup');
              if (popup && !popup.matches(':hover')) {
                removePopup();
              }
            }, 150);
          });
        }
      });
    </script>
  </body>
</html>
