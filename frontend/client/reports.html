<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reports Management - WasteNaut Admin</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../resources/styles/main.css" />
    
    <!-- Custom Styles for Reports -->
    <style>
      .report-card {
        transition: all 0.3s ease;
        border-left: 4px solid transparent;
      }
      
      .report-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }
      
      .report-card.pending {
        border-left-color: #ffc107;
      }
      
      .report-card.in-progress {
        border-left-color: #0dcaf0;
      }
      
      .report-card.resolved {
        border-left-color: #198754;
      }
      
      .report-card.rejected {
        border-left-color: #dc3545;
      }
      
      .priority-high {
        background: linear-gradient(135deg, #dc3545, #c82333);
      }
      
      .priority-medium {
        background: linear-gradient(135deg, #ffc107, #e0a800);
      }
      
      .priority-low {
        background: linear-gradient(135deg, #198754, #157347);
      }
      
      .filter-btn.active {
        background-color: #0d6efd !important;
        border-color: #0d6efd !important;
      }
    </style>
  </head>
  <body>
    <!-- Header Container -->
    <div id="header-container"></div>

    <!-- Main Content -->
    <div class="container py-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div class="d-flex align-items-center">
              <div class="bg-warning rounded-circle d-inline-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
                <i class="bi bi-flag text-white fs-5"></i>
              </div>
              <div>
                <h1 class="h3 mb-1 text-gradient">Reports Management</h1>
                <p class="text-muted mb-0">Review and manage user reports and issues</p>
              </div>
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-outline-primary" onclick="refreshReports()">
                <i class="bi bi-arrow-clockwise me-1"></i>Refresh
              </button>
              <button class="btn btn-primary" onclick="exportReports()">
                <i class="bi bi-download me-1"></i>Export
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="row g-4 mb-4">
        <div class="col-md-3">
          <div class="card border-0 bg-dark glow-effect">
            <div class="card-body text-center p-3">
              <div class="bg-warning rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                <i class="bi bi-clock text-white fs-4"></i>
              </div>
              <div class="fw-bold fs-3" id="pendingCount">12</div>
              <div class="small text-muted">Pending Reports</div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card border-0 bg-dark glow-effect">
            <div class="card-body text-center p-3">
              <div class="bg-info rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                <i class="bi bi-arrow-repeat text-white fs-4"></i>
              </div>
              <div class="fw-bold fs-3" id="inProgressCount">8</div>
              <div class="small text-muted">In Progress</div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card border-0 bg-dark glow-effect">
            <div class="card-body text-center p-3">
              <div class="bg-success rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                <i class="bi bi-check-circle text-white fs-4"></i>
              </div>
              <div class="fw-bold fs-3" id="resolvedCount">156</div>
              <div class="small text-muted">Resolved</div>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card border-0 bg-dark glow-effect">
            <div class="card-body text-center p-3">
              <div class="bg-danger rounded-circle d-inline-flex align-items-center justify-content-center mb-2" style="width: 50px; height: 50px;">
                <i class="bi bi-x-circle text-white fs-4"></i>
              </div>
              <div class="fw-bold fs-3" id="rejectedCount">23</div>
              <div class="small text-muted">Rejected</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Filters and Search -->
      <div class="card border-0 bg-dark mb-4">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Search Reports</label>
              <input type="text" class="form-control" id="searchInput" placeholder="Search by reporter, description, or ID...">
            </div>
            <div class="col-md-2">
              <label class="form-label">Status</label>
              <select class="form-select" id="statusFilter">
                <option value="">All Statuses</option>
                <option value="pending">Pending</option>
                <option value="in-progress">In Progress</option>
                <option value="resolved">Resolved</option>
                <option value="rejected">Rejected</option>
              </select>
            </div>
            <div class="col-md-2">
              <label class="form-label">Priority</label>
              <select class="form-select" id="priorityFilter">
                <option value="">All Priorities</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
              </select>
            </div>
            <div class="col-md-2">
              <label class="form-label">Type</label>
              <select class="form-select" id="typeFilter">
                <option value="">All Types</option>
                <option value="abuse">Abuse</option>
                <option value="spam">Spam</option>
                <option value="inappropriate">Inappropriate Content</option>
                <option value="technical">Technical Issue</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="col-md-2">
              <label class="form-label">&nbsp;</label>
              <button class="btn btn-outline-secondary w-100" onclick="clearFilters()">
                <i class="bi bi-x-circle me-1"></i>Clear
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Reports List -->
      <div class="card border-0 bg-dark">
        <div class="card-header bg-dark border-bottom">
          <h5 class="mb-0">
            <i class="bi bi-list-ul me-2"></i>Reports
            <span class="badge bg-primary ms-2" id="totalReportsCount">199</span>
          </h5>
        </div>
        <div class="card-body p-0">
          <div id="reportsList">
            <!-- Sample Reports -->
            <div class="report-card pending p-3 border-bottom border-secondary">
              <div class="row align-items-center">
                <div class="col-md-1">
                  <div class="priority-high rounded-circle d-inline-flex align-items-center justify-content-center text-white fw-bold" style="width: 30px; height: 30px; font-size: 0.8rem;">
                    H
                  </div>
                </div>
                <div class="col-md-2">
                  <div class="fw-bold">#RPT-001</div>
                  <div class="small text-muted">2 hours ago</div>
                </div>
                <div class="col-md-3">
                  <div class="fw-bold">Inappropriate Content</div>
                  <div class="small text-muted">Reported by: Sarah Johnson</div>
                </div>
                <div class="col-md-4">
                  <div class="text-truncate">User posted offensive content in donation comments section...</div>
                </div>
                <div class="col-md-2">
                  <div class="d-flex gap-1">
                    <button class="btn btn-sm btn-outline-primary" onclick="viewReport(1)">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success" onclick="updateReportStatus(1, 'in-progress')">
                      <i class="bi bi-arrow-right"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="report-card in-progress p-3 border-bottom border-secondary">
              <div class="row align-items-center">
                <div class="col-md-1">
                  <div class="priority-medium rounded-circle d-inline-flex align-items-center justify-content-center text-white fw-bold" style="width: 30px; height: 30px; font-size: 0.8rem;">
                    M
                  </div>
                </div>
                <div class="col-md-2">
                  <div class="fw-bold">#RPT-002</div>
                  <div class="small text-muted">1 day ago</div>
                </div>
                <div class="col-md-3">
                  <div class="fw-bold">Spam</div>
                  <div class="small text-muted">Reported by: Mike Chen</div>
                </div>
                <div class="col-md-4">
                  <div class="text-truncate">Multiple fake donation listings detected...</div>
                </div>
                <div class="col-md-2">
                  <div class="d-flex gap-1">
                    <button class="btn btn-sm btn-outline-primary" onclick="viewReport(2)">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success" onclick="updateReportStatus(2, 'resolved')">
                      <i class="bi bi-check"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="report-card resolved p-3 border-bottom border-secondary">
              <div class="row align-items-center">
                <div class="col-md-1">
                  <div class="priority-low rounded-circle d-inline-flex align-items-center justify-content-center text-white fw-bold" style="width: 30px; height: 30px; font-size: 0.8rem;">
                    L
                  </div>
                </div>
                <div class="col-md-2">
                  <div class="fw-bold">#RPT-003</div>
                  <div class="small text-muted">3 days ago</div>
                </div>
                <div class="col-md-3">
                  <div class="fw-bold">Technical Issue</div>
                  <div class="small text-muted">Reported by: Emma Wilson</div>
                </div>
                <div class="col-md-4">
                  <div class="text-truncate">Login page not loading properly on mobile devices...</div>
                </div>
                <div class="col-md-2">
                  <div class="d-flex gap-1">
                    <button class="btn btn-sm btn-outline-primary" onclick="viewReport(3)">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" disabled>
                      <i class="bi bi-check-circle"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="report-card pending p-3 border-bottom border-secondary">
              <div class="row align-items-center">
                <div class="col-md-1">
                  <div class="priority-high rounded-circle d-inline-flex align-items-center justify-content-center text-white fw-bold" style="width: 30px; height: 30px; font-size: 0.8rem;">
                    H
                  </div>
                </div>
                <div class="col-md-2">
                  <div class="fw-bold">#RPT-004</div>
                  <div class="small text-muted">4 hours ago</div>
                </div>
                <div class="col-md-3">
                  <div class="fw-bold">Abuse</div>
                  <div class="small text-muted">Reported by: David Brown</div>
                </div>
                <div class="col-md-4">
                  <div class="text-truncate">User harassing other members in chat...</div>
                </div>
                <div class="col-md-2">
                  <div class="d-flex gap-1">
                    <button class="btn btn-sm btn-outline-primary" onclick="viewReport(4)">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-success" onclick="updateReportStatus(4, 'in-progress')">
                      <i class="bi bi-arrow-right"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="report-card rejected p-3 border-bottom border-secondary">
              <div class="row align-items-center">
                <div class="col-md-1">
                  <div class="priority-low rounded-circle d-inline-flex align-items-center justify-content-center text-white fw-bold" style="width: 30px; height: 30px; font-size: 0.8rem;">
                    L
                  </div>
                </div>
                <div class="col-md-2">
                  <div class="fw-bold">#RPT-005</div>
                  <div class="small text-muted">1 week ago</div>
                </div>
                <div class="col-md-3">
                  <div class="fw-bold">Other</div>
                  <div class="small text-muted">Reported by: Lisa Garcia</div>
                </div>
                <div class="col-md-4">
                  <div class="text-truncate">Request for feature that already exists...</div>
                </div>
                <div class="col-md-2">
                  <div class="d-flex gap-1">
                    <button class="btn btn-sm btn-outline-primary" onclick="viewReport(5)">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" disabled>
                      <i class="bi bi-x-circle"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Report Details Modal -->
    <div class="modal fade" id="reportDetailsModal" tabindex="-1" aria-labelledby="reportDetailsModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark text-light">
          <div class="modal-header border-secondary">
            <h5 class="modal-title" id="reportDetailsModalLabel">
              <i class="bi bi-flag me-2"></i>Report Details
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row mb-3">
              <div class="col-md-6">
                <h6>Report Information</h6>
                <p><strong>ID:</strong> <span id="reportId">#RPT-001</span></p>
                <p><strong>Type:</strong> <span id="reportType">Inappropriate Content</span></p>
                <p><strong>Priority:</strong> <span id="reportPriority" class="badge bg-danger">High</span></p>
                <p><strong>Status:</strong> <span id="reportStatus" class="badge bg-warning">Pending</span></p>
              </div>
              <div class="col-md-6">
                <h6>Reporter Information</h6>
                <p><strong>Name:</strong> <span id="reporterName">Sarah Johnson</span></p>
                <p><strong>Email:</strong> <span id="reporterEmail">sarah.j@email.com</span></p>
                <p><strong>Reported At:</strong> <span id="reportDate">2024-01-15 14:30</span></p>
                <p><strong>Assigned To:</strong> <span id="assignedAdmin">Admin User</span></p>
              </div>
            </div>
            
            <div class="mb-3">
              <h6>Description</h6>
              <div class="bg-secondary p-3 rounded">
                <p id="reportDescription">User posted offensive content in donation comments section. The content includes inappropriate language and discriminatory remarks that violate our community guidelines.</p>
              </div>
            </div>
            
            <div class="mb-3">
              <h6>Evidence</h6>
              <div class="bg-secondary p-3 rounded">
                <p class="text-muted">Screenshots and chat logs attached</p>
                <div class="d-flex gap-2">
                  <button class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-image me-1"></i>View Screenshots
                  </button>
                  <button class="btn btn-sm btn-outline-info">
                    <i class="bi bi-chat-text me-1"></i>View Chat Logs
                  </button>
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <h6>Admin Notes</h6>
              <textarea class="form-control bg-dark text-light" id="adminNotes" rows="3" placeholder="Add notes about this report..."></textarea>
            </div>
          </div>
          <div class="modal-footer border-secondary">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-warning" onclick="updateReportStatusFromModal('in-progress')">
              <i class="bi bi-arrow-right me-1"></i>Mark In Progress
            </button>
            <button type="button" class="btn btn-success" onclick="updateReportStatusFromModal('resolved')">
              <i class="bi bi-check me-1"></i>Resolve
            </button>
            <button type="button" class="btn btn-danger" onclick="updateReportStatusFromModal('rejected')">
              <i class="bi bi-x me-1"></i>Reject
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- Custom JS -->
    <script src="../resources/scripts/main.js"></script>
    <script src="../resources/scripts/api-service.js"></script>
    <script src="../resources/scripts/auth.js"></script>
    <script src="../resources/scripts/header-include.js"></script>
    <script src="../resources/scripts/header.js"></script>
    
    <script>
      // Reports management functionality
      let currentReportId = null;
      
      document.addEventListener('DOMContentLoaded', function() {
        loadReports();
        setupFilters();
      });
      
      function loadReports() {
        // In a real application, this would fetch from the API
        console.log('Loading reports...');
        updateStatistics();
      }
      
      function updateStatistics() {
        // Update the statistics cards
        document.getElementById('pendingCount').textContent = '12';
        document.getElementById('inProgressCount').textContent = '8';
        document.getElementById('resolvedCount').textContent = '156';
        document.getElementById('rejectedCount').textContent = '23';
        document.getElementById('totalReportsCount').textContent = '199';
      }
      
      function setupFilters() {
        const searchInput = document.getElementById('searchInput');
        const statusFilter = document.getElementById('statusFilter');
        const priorityFilter = document.getElementById('priorityFilter');
        const typeFilter = document.getElementById('typeFilter');
        
        [searchInput, statusFilter, priorityFilter, typeFilter].forEach(element => {
          element.addEventListener('change', filterReports);
        });
      }
      
      function filterReports() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const statusFilter = document.getElementById('statusFilter').value;
        const priorityFilter = document.getElementById('priorityFilter').value;
        const typeFilter = document.getElementById('typeFilter').value;
        
        const reportCards = document.querySelectorAll('.report-card');
        
        reportCards.forEach(card => {
          let show = true;
          
          // Search filter
          if (searchTerm) {
            const text = card.textContent.toLowerCase();
            if (!text.includes(searchTerm)) {
              show = false;
            }
          }
          
          // Status filter
          if (statusFilter) {
            if (!card.classList.contains(statusFilter)) {
              show = false;
            }
          }
          
          // Priority filter (simplified for demo)
          if (priorityFilter) {
            const priorityElement = card.querySelector('.priority-high, .priority-medium, .priority-low');
            if (priorityFilter === 'high' && !priorityElement?.classList.contains('priority-high')) {
              show = false;
            } else if (priorityFilter === 'medium' && !priorityElement?.classList.contains('priority-medium')) {
              show = false;
            } else if (priorityFilter === 'low' && !priorityElement?.classList.contains('priority-low')) {
              show = false;
            }
          }
          
          card.style.display = show ? 'block' : 'none';
        });
      }
      
      function clearFilters() {
        document.getElementById('searchInput').value = '';
        document.getElementById('statusFilter').value = '';
        document.getElementById('priorityFilter').value = '';
        document.getElementById('typeFilter').value = '';
        
        const reportCards = document.querySelectorAll('.report-card');
        reportCards.forEach(card => {
          card.style.display = 'block';
        });
      }
      
      function viewReport(reportId) {
        currentReportId = reportId;
        
        // In a real application, this would fetch report details from the API
        const modal = new bootstrap.Modal(document.getElementById('reportDetailsModal'));
        modal.show();
      }
      
      function updateReportStatus(reportId, status) {
        if (window.showNotification) {
          window.showNotification(`Report #${reportId} status updated to ${status}`, 'success');
        } else {
          alert(`Report #${reportId} status updated to ${status}`);
        }
        
        // Update the UI
        const reportCard = document.querySelector(`[onclick*="viewReport(${reportId})"]`).closest('.report-card');
        reportCard.className = reportCard.className.replace(/pending|in-progress|resolved|rejected/g, status);
        
        // Update statistics
        updateStatistics();
      }
      
      function updateReportStatusFromModal(status) {
        if (currentReportId) {
          updateReportStatus(currentReportId, status);
          const modal = bootstrap.Modal.getInstance(document.getElementById('reportDetailsModal'));
          modal.hide();
        }
      }
      
      function refreshReports() {
        if (window.showNotification) {
          window.showNotification('Reports refreshed successfully', 'info');
        } else {
          alert('Reports refreshed successfully');
        }
        loadReports();
      }
      
      function exportReports() {
        if (window.showNotification) {
          window.showNotification('Exporting reports to CSV...', 'info');
        } else {
          alert('Exporting reports to CSV...');
        }
      }
    </script>
  </body>
</html>
